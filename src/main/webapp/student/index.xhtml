<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Gamified Reflection</title>
        <h:outputStylesheet library="webjars" name="bootstrap/3.3.7-1/css/bootstrap.min-jsf.css" />
        <style>
            .ui-progressbar {
                height: 1.6em;
            }
            @media screen and (min-width: 768px) { 
                .row.main-content{
                    display: -webkit-box;
                    display: -webkit-flex;
                    display: -ms-flexbox;
                    display:         flex;
                }
                .row.main-content > [class*='col-'] {
                    display: flex;
                    flex-direction: column;
                }
            }
            @media screen and (max-width: 767px) {
                .row.main-content{
                    display: block !important;
                }
                .row.main-content > [class*='col-'] {
                    display: block;
                }
            }
            .row.header > [class*='col-'] {
                padding-left: 2em;
                padding-right: 2em;
            }
        </style>
    </h:head>
    <h:body>
        <div class="container-fluid">
            <div class="row header">
                <div  class="col-lg-3 col-md-4 col-sm-4 col-xs-4">
                    <h:form id="welcome">
                        <p:outputLabel value="Welcome,&#160;" /> 
                        <p:outputLabel rendered="#{!profileController.editing}" value="#{profileController.student.nickname}!" />
                        <p:inputText id="nickname" rendered="#{profileController.editing}" value="#{profileController.student.nickname}" maxlength="12" style="width: 10em"/>
                        <p:commandButton rendered="#{profileController.editing}" value="OK" type="submit" actionListener="#{profileController.changeNickname()}" ajax="true" update="welcome @(:info)"/>
                        <span class="ui-state-error-text"><h:messages id="nicknameMsg" showSummary="false" showDetail="true" style="list-style-type: none; padding-left:0;"/></span>
                        <p:commandLink rendered="#{!profileController.editing}" value="Change nickname" actionListener="#{profileController.setEditing(true)}" ajax="true" update="welcome"/>
                    </h:form>
                </div>
                <div class="col-lg-2 col-md-4 col-lg-offset-2 col-sm-4 col-xs-4 text-center">
                    <h:outputText value="#{aux.student.level}" style="font-weight: bold"/>
                    <br></br>
                    <p:progressBar value="#{aux.progress}" labelTemplate="{value}%"/>
                </div>
                <div class="col-lg-2 col-md-4 col-lg-offset-3 col-sm-4 col-xs-4 text-right" style="padding-top: 0.9em">
                    <h:form>
                        <p:commandButton class="btn btn-danger" value="Logout" actionListener="#{loginController.logout()}" style="padding: 0.2em" />
                    </h:form>   
                </div>
            </div>
            <div class="row main-content container-fluid">
                <p:panel id="info" class="col-md-5 col-lg-5 col-xs-12">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <p:link rendered="#{profileController.activitiesPending}" value="New activities available!" outcome="logger.html" style="background-color: #ff9933"/>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <h:form>
                                <h:selectOneMenu value="#{aux.selectedCategory}" style="float: right">
                                    <f:ajax render=":topThreeImg" />
                                    <f:converter converterId="categoriesConverter" />
                                    <f:selectItem itemLabel="Overall Score" itemValue=""/>
                                    <f:selectItems value="#{profileController.categories}" var="category" itemValue="#{category.title}" itemLabel="#{category.title}" />
                                </h:selectOneMenu>
                            </h:form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-8 col-xs-offset-2">
                            <p:graphicImage id="topThreeImg" value="#{aux.graphicImage}" style="width: 100%; height: auto;"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 col-xs-12">
                            <p:dataTable value="#{aux.selectedCategory ne null ? aux.studentsScores.entrySet().toArray() : aux.studentsOverallScores.entrySet().toArray()}" var="student" class="text-center">
                                <p:column headerText="Nickname">
                                    <h:outputText value="#{student.key.nickname}"/>
                                </p:column>
                                <p:column headerText="#{aux.selectedCategory ne null ? aux.selectedCategory.title : 'Overall'} Score">
                                    <h:outputText value="#{student.value}"/>
                                </p:column>
                                <p:column headerText="Student Level">
                                    <h:outputText value="#{student.key.level}"/>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </p:panel>
                <p:panel id="studentDetails" class="col-md-7 col-lg-7 col-xs-12">
                    <p:chart id="barChart" type="bar" model="#{profileController.barModel}" style="width: available"/>
                    <p:chart id="lineChart" type="line" model="#{profileController.lineModel}"  style="width: available"/>
                </p:panel>  
            </div>    
        </div>
    </h:body>
</html>

